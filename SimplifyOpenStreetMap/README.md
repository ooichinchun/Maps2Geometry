## Automatic Simplification of Buildings from [Open Street Map](https://www.openstreetmap.org)

#### Exporting Data from Open Street Map

It is possible to extract data for a specified minimum and maximum latitude and longitude.  
It is worth remembering that the conversion factor is approximately 11.1m for 0.0001 degree when specifying the range required.

| ![Sample OSM Interface](https://github.com/ooichinchun/Maps2Geometry/blob/master/SimplifyOpenStreetMap/OSM_Example.jpg "Exporting OSM Data") | 
|:--:| 
| **Sample OSM interface for exporting OSM data** |

Specifying the LATITUDE and LONGITUDE in the highlighted yellow boxes on the left, and the appropriate scale and file format on the right allows for easy parsing of OSM data.
We chose to save the data in the pdf format for easy conversion in Illustrator to svg format. 

### Automatic Generation of 2D Building Footprint from OpenStreetMap Data via Python

The workflow can be understood in terms of the following sections.

#### 01. Parse SVG file for desired geometries via filtering by hexadecimal color-code

After exporting the image from OpenStreetMap, we save the image as an svg file in Illustrator, and note the color codes for the geometries of interest. 

The script [consolidate_polygons.py](https://github.com/ooichinchun/Maps2Geometry/blob/master/SimplifyOpenStreetMap/consolidate_polygons.py) is then used to extract all the relevant lines from the svg file. 

#### 02. Obtain the convex hull reduced representation of the building geometries via Python

The .txt file from Step 1 can be processed with this [script](https://github.com/ooichinchun/Maps2Geometry/blob/master/SimplifyOpenStreetMap/convex_hull_polygon_rect_paths.py) to simplfiy all geometry objects into a [convex hull](http://www.qhull.org/) representation. 

Another text file will be generated containing the vertices of all the convex hull simplified geometries in svg format.

In our experience, the geometry objects are typically represented in only 3 forms in the input svg files: as line 'path', as 'rect' objects, and as 'polygon' objects. Only these 3 formats are handled here, and it is worth noting that additional code might be required if the svg file formats differ significantly.

| ![Sample Convex Hull Conversion](https://github.com/ooichinchun/Maps2Geometry/blob/master/SimplifyOpenStreetMap/ConvexHull.JPG "Convex Hull Simplification of Geometry") | 
|:--:| 
| **Sample of how the convex hull algorithm affects the geometry** |

In the example above, the light gray areas represent the original building geometry, while the black lines are the new 2D footprint after passing the geometries through the convex hull algorithm.

#### 03. Reformatting output to svg file format

The output is not an svg file, and must be combined with the header and footer tags from the original svg file. 

Example svg file format is of the typical form: 

    <?xml version="1.0" encoding="utf-8"?>
    <!-- Generator: Adobe Illustrator 14.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 43363)  -->
    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    width="1387.32px" height="1422.143px" viewBox="0 0 1387.32 1422.143" enable-background="new 0 0 1387.32 1422.143"
    xml:space="preserve">
    <g enable-background="new    ">

    Paste Output of Script

    </g>
    </svg>

This output svg file must be re-generated by copying the first few lines, and the last few lines in combination with the text file output from Step 2.

#### 04. Re-export svg file as a dwg file for reading into a CAD program

The above svg file is still not a CAD file, and we have chosen to use Adobe Illustrator to re-save the file format as a dwg file for import into a proper CAD program. It should be noted that we created the file text output to contain all the vertices, and hence, they could have been saved directly into a CAD format such as an IGES format, but we have chosen to use Illustrator here to simplify that process. Nonetheless, other open-source scripts exist to supplement this.

